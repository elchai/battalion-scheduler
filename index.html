<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a237e">
    <title>מערכת ניהול גדודי | תעסוקה מבצעית</title>
    <link rel="icon" href="logo.png" type="image/png">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="logo.png">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Login Screen -->
<div class="login-screen" id="loginScreen">
    <div class="login-box">
        <img src="logo.png" alt="גדוד יהודה" style="width:100px;height:100px;border-radius:50%;margin-bottom:16px;box-shadow:0 4px 15px rgba(0,0,0,0.2);">
        <h2>מערכת ניהול גדודי</h2>
        <div class="subtitle">תעסוקה מבצעית - כניסה למערכת</div>
        <div class="login-field">
            <label>שם מלא</label>
            <input type="text" id="loginName" placeholder="הכנס את שמך">
        </div>
        <div class="login-field">
            <label>מסגרת</label>
            <select id="loginUnit">
                <option value="">-- בחר מסגרת --</option>
                <option value="a">פלוגה א (מבוא חורון)</option>
                <option value="b">פלוגה ב (443)</option>
                <option value="c">פלוגה ג (חשמונאים)</option>
                <option value="d">פלוגה ד (עתודה)</option>
                <option value="hq">חפ"ק מג"ד/סמג"ד</option>
                <option value="palsam">פלס"ם</option>
                <option value="gdudi">גדודי</option>
            </select>
        </div>
        <div class="login-field">
            <label>סיסמה</label>
            <input type="password" id="loginPassword" placeholder="הכנס סיסמה">
        </div>
        <button class="login-btn" onclick="doLogin()">כניסה למערכת</button>
        <div class="login-error" id="loginError">סיסמה שגויה, נסה שוב</div>
    </div>
    <div class="login-footer">
        מערכת מאובטחת - גישה מורשית בלבד<br>
        <a href="https://wa.me/972542012000" target="_blank" style="color:rgba(255,255,255,0.7);text-decoration:none;margin-top:6px;display:inline-block;">
            נבנה ע"י אלחי פיין | 054-2012000
        </a>
    </div>
</div>

<div id="mainApp" style="display:none;">

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <img src="logo.png" alt="גדוד יהודה" class="sidebar-logo">
        <div class="sidebar-brand">
            <div class="sidebar-title">ניהול גדודי</div>
            <div class="sidebar-subtitle">תעסוקה מבצעית</div>
        </div>
        <button class="sidebar-close" id="sidebarClose" onclick="toggleSidebar()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
        </button>
    </div>
    <nav class="sidebar-nav">
        <div class="sidebar-section-label">ראשי</div>
        <button class="sidebar-item tab-all active" onclick="switchTab('all')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
            <span>סקירה כללית</span>
        </button>

        <div class="sidebar-section-label">פלוגות</div>
        <button class="sidebar-item tab-a" onclick="switchTab('a')">
            <span class="sidebar-dot" style="background:var(--pluga-a);"></span>
            <span>פלוגה א (מבוא חורון)</span>
            <span class="sidebar-count tab-count">41</span>
        </button>
        <button class="sidebar-item tab-b" onclick="switchTab('b')">
            <span class="sidebar-dot" style="background:var(--pluga-b);"></span>
            <span>פלוגה ב (443)</span>
            <span class="sidebar-count tab-count">52</span>
        </button>
        <button class="sidebar-item tab-c" onclick="switchTab('c')">
            <span class="sidebar-dot" style="background:var(--pluga-c);"></span>
            <span>פלוגה ג (חשמונאים)</span>
            <span class="sidebar-count tab-count">50</span>
        </button>
        <button class="sidebar-item tab-d" onclick="switchTab('d')">
            <span class="sidebar-dot" style="background:var(--pluga-d);"></span>
            <span>פלוגה ד (עתודה)</span>
            <span class="sidebar-count tab-count">55</span>
        </button>
        <button class="sidebar-item tab-hq" onclick="switchTab('hq')">
            <span class="sidebar-dot" style="background:#607D8B;"></span>
            <span>חפ"ק מג"ד</span>
        </button>
        <button class="sidebar-item tab-palsam" onclick="switchTab('palsam')">
            <span class="sidebar-dot" style="background:#795548;"></span>
            <span>פלס"ם</span>
        </button>

        <div class="sidebar-section-label">כלים</div>
        <button class="sidebar-item tab-reports" onclick="switchTab('reports')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
            <span>דוחות</span>
        </button>
        <button class="sidebar-item tab-calendar" onclick="switchTab('calendar')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
            <span>לוח שבועי</span>
        </button>
        <button class="sidebar-item tab-rotation" onclick="switchTab('rotation')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 11-6.219-8.56"/><polyline points="21 3 21 9 15 9"/></svg>
            <span>רוטציה 10/4</span>
        </button>
        <button class="sidebar-item tab-equipment" onclick="switchTab('equipment')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="1"/><path d="M9 14l2 2 4-4"/></svg>
            <span>צל"מ</span>
        </button>
        <button class="sidebar-item tab-settings" onclick="switchTab('settings')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
            <span>הגדרות</span>
        </button>
    </nav>
    <div class="sidebar-footer">
        <div class="sidebar-user" id="sidebarUser"></div>
        <button class="sidebar-logout" onclick="doLogout()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
            יציאה
        </button>
    </div>
</div>
<div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

<!-- Top Bar -->
<div class="topbar" id="topbar">
    <div class="topbar-right">
        <button class="topbar-menu" onclick="toggleSidebar()">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
        </button>
        <h1 class="topbar-title">מערכת ניהול גדודי</h1>
        <span class="topbar-badge">תעסוקה מבצעית</span>
        <span class="topbar-badge topbar-badge-red">רוטציה 10/4</span>
    </div>
    <div class="topbar-stats">
        <div class="topbar-stat">
            <div class="topbar-stat-num" id="totalSoldiers">166</div>
            <div class="topbar-stat-label">חיילים</div>
        </div>
        <div class="topbar-stat">
            <div class="topbar-stat-num" id="totalCommanders">20</div>
            <div class="topbar-stat-label">מפקדים</div>
        </div>
        <div class="topbar-stat">
            <div class="topbar-stat-num" id="totalOfficers">12</div>
            <div class="topbar-stat-label">קצינים</div>
        </div>
        <div class="topbar-stat">
            <div class="topbar-stat-num" id="totalOnDuty">0</div>
            <div class="topbar-stat-label">בבסיס</div>
        </div>
        <div class="topbar-stat">
            <div class="topbar-stat-num" id="totalOnLeave">0</div>
            <div class="topbar-stat-label">בבית</div>
        </div>
    </div>
    <div class="topbar-left">
        <div class="notif-wrapper">
            <button class="topbar-bell" onclick="toggleNotifications()" title="התראות">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
                <span class="notif-badge" id="notifBadge" style="display:none;">0</span>
            </button>
            <div class="notif-panel" id="notifPanel">
                <div class="notif-panel-header">
                    <span>התראות</span>
                    <button class="notif-close" onclick="toggleNotifications()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                    </button>
                </div>
                <div class="notif-list" id="notifList"></div>
            </div>
        </div>
        <button class="topbar-bell" onclick="toggleDarkMode()" title="מצב כהה" id="darkModeBtn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="darkModeIcon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
        </button>
        <span class="topbar-user" id="userBadge" title="משתמש מחובר"></span>
        <button class="topbar-logout" onclick="doLogout()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        </button>
    </div>
</div>

<div class="toast-container" id="toastContainer"></div>

<!-- ====== TAB: OVERVIEW ====== -->
<div class="tab-content active" id="tab-all">
    <div class="main-content">
        <div class="info-box">
            <span class="info-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg></span>
            <div>
                <strong>מודל רוטציה 10/4:</strong> כל חייל 10 ימים בבסיס, 4 ימים בבית.
                פלוגה ד (עתודה) מספקת תגבור של כ-12 חיילים למילוי חוסרים בזמן יציאות.
            </div>
        </div>
        <div class="quick-stats">
            <div class="quick-stat"><div class="value" id="statTotalPersonnel">198</div><div class="label">סה"כ כוח אדם</div></div>
            <div class="quick-stat"><div class="value">4</div><div class="label">פלוגות</div></div>
            <div class="quick-stat"><div class="value" id="statAssigned">0</div><div class="label">משובצים</div></div>
            <div class="quick-stat"><div class="value" id="statHome">0</div><div class="label">בבית</div></div>
            <div class="quick-stat"><div class="value" id="statAvailable">0</div><div class="label">זמינים</div></div>
            <div class="quick-stat" style="border-top:3px solid var(--pluga-d);"><div class="value" id="statReinforcement">12</div><div class="label">תגבור פלוגה ד</div></div>
        </div>
        <!-- Dashboard Charts -->
        <div class="dashboard-grid" id="dashboardGrid"></div>

        <!-- Alerts -->
        <div id="dashboardAlerts"></div>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;">
            <div class="section-title" style="margin-bottom:0">
                <div class="icon" style="background:#e3f2fd;color:var(--primary);"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4-4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg></div>
                סקירת פלוגות
            </div>
            <button class="btn btn-primary" onclick="syncFromGoogleSheets(false)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;margin-left:4px;"><path d="M21 12a9 9 0 11-6.219-8.56"/><polyline points="21 3 21 9 15 9"/></svg> סנכרון מגוגל שיטס</button>
        </div>
        <div class="companies-grid" id="companiesGrid"></div>
    </div>
</div>

<!-- ====== COMPANY TABS ====== -->
<div class="tab-content" id="tab-a"><div class="main-content" id="content-a"></div></div>
<div class="tab-content" id="tab-b"><div class="main-content" id="content-b"></div></div>
<div class="tab-content" id="tab-c"><div class="main-content" id="content-c"></div></div>
<div class="tab-content" id="tab-d"><div class="main-content" id="content-d"></div></div>
<div class="tab-content" id="tab-hq"><div class="main-content" id="content-hq"></div></div>
<div class="tab-content" id="tab-palsam"><div class="main-content" id="content-palsam"></div></div>

<!-- ====== TAB: CALENDAR ====== -->
<div class="tab-content" id="tab-calendar">
    <div class="main-content">
        <div class="cal-header">
            <button class="btn" style="background:var(--bg)" onclick="calendarNav(-1)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
            </button>
            <h2 class="cal-title" id="calTitle"></h2>
            <button class="btn" style="background:var(--bg)" onclick="calendarNav(1)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
            </button>
            <button class="btn btn-primary" style="margin-right:auto;" onclick="calendarNav(0)">היום</button>
            <select id="calCompanyFilter" onchange="renderCalendar()" style="padding:6px 12px;border-radius:8px;border:1px solid var(--border);font-family:inherit;">
                <option value="all">כל הפלוגות</option>
                <option value="a">פלוגה א</option>
                <option value="b">פלוגה ב</option>
                <option value="c">פלוגה ג</option>
                <option value="d">פלוגה ד</option>
                <option value="hq">חפ"ק מג"ד</option>
                <option value="palsam">פלס"ם</option>
            </select>
        </div>
        <div class="cal-grid" id="calGrid"></div>
    </div>
</div>

<!-- ====== TAB: REPORTS ====== -->
<div class="tab-content" id="tab-reports">
    <div class="main-content">
        <div class="section-title">
            <div class="icon" style="background:#e3f2fd;color:var(--primary);"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg></div>
            הפקת דוחות
        </div>
        <div class="reports-grid">
            <div class="report-card" onclick="generateDailyReport()">
                <div class="report-icon" style="background:#e8f5e9;color:#2e7d32;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                </div>
                <h3>דו"ח יומי</h3>
                <p>סיכום מצב יומי - כוח אדם, שיבוצים, יציאות ורוטציה</p>
            </div>
            <div class="report-card" onclick="generateCompanyReport()">
                <div class="report-icon" style="background:#e3f2fd;color:#1565c0;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4-4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
                </div>
                <h3>דו"ח פלוגות</h3>
                <p>מצב כוח אדם מפורט לכל פלוגה - חיילים, מפקדים, קצינים</p>
            </div>
            <div class="report-card" onclick="generateShiftsReport()">
                <div class="report-icon" style="background:#fff3e0;color:#e65100;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                </div>
                <h3>דו"ח שיבוצים</h3>
                <p>כל השיבוצים הפעילים - לפי פלוגה, משימה ותאריך</p>
            </div>
            <div class="report-card" onclick="generateLeavesReport()">
                <div class="report-icon" style="background:#fce4ec;color:#c62828;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                </div>
                <h3>דו"ח יציאות</h3>
                <p>כל היציאות הפעילות והמתוכננות לפי פלוגה</p>
            </div>
        </div>
        <div id="reportOutput" class="report-output"></div>
    </div>
</div>

<!-- ====== TAB: ROTATION ====== -->
<div class="tab-content" id="tab-rotation">
    <div class="main-content">
        <div class="info-box">
            <span class="info-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 11-6.219-8.56"/><polyline points="21 3 21 9 15 9"/></svg></span>
            <div>
                <strong>ניהול רוטציה 10/4:</strong> חלק את החיילים לקבוצות רוטציה.
                כל קבוצה עושה 10 ימים בבסיס ואז 4 ימים בבית.
                המערכת מחשבת אוטומטית מי בבסיס ומי בבית לפי תאריך ההתחלה.
            </div>
        </div>
        <div class="action-bar">
            <button class="btn btn-primary" onclick="openModal('addRotationGroupModal')">+ קבוצת רוטציה חדשה</button>
        </div>

        <!-- Rotation Visual Calendar -->
        <div class="sub-section">
            <div class="section-title">
                <div class="icon" style="background:#EDE7F6;color:#5C6BC0;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></div>
                לוח רוטציה - 14 ימים קדימה
            </div>
            <div class="rotation-calendar">
                <div class="rotation-body" id="rotationCalendar"></div>
            </div>
        </div>

        <!-- Rotation Groups -->
        <div class="sub-section">
            <div class="section-title">
                <div class="icon" style="background:#E8F5E9;color:var(--success);"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4-4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg></div>
                קבוצות רוטציה
            </div>
            <div class="rotation-groups" id="rotationGroupsContainer"></div>
        </div>
    </div>
</div>

<!-- ====== TAB: EQUIPMENT (צל"מ) ====== -->
<div class="tab-content" id="tab-equipment">
    <div class="main-content">
        <div class="info-box">
            <span class="info-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="1"/><path d="M9 14l2 2 4-4"/></svg></span>
            <div>
                <strong>ניהול צל"מ - ציוד לחימה מבוקר:</strong> חתימה דיגיטלית על ציוד עם מספר סידורי.
                כל חתימה כוללת זיהוי חייל, חתימה ויזואלית, ושמירה כ-PDF.
            </div>
        </div>
        <div class="action-bar">
            <button class="btn btn-primary" onclick="openAddEquipment()">+ הוספת פריט ציוד</button>
            <button class="btn btn-success" onclick="openSignEquipment()">&#9998; חתימה על ציוד</button>
            <button class="btn btn-warning" onclick="openReturnEquipment()">&#8634; זיכוי / החזרת ציוד</button>
            <button class="btn" style="background:var(--bg)" onclick="exportEquipmentCSV()">&#128196; ייצוא CSV</button>
        </div>

        <!-- Equipment Stats -->
        <div class="quick-stats" id="equipmentStats"></div>

        <!-- Equipment Search -->
        <div class="search-bar">
            <span class="search-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></span>
            <input type="text" id="equipmentSearch" placeholder="חיפוש לפי שם פריט, מספר סידורי, חייל..." oninput="renderEquipmentTab()">
        </div>
        <div class="filter-buttons" style="margin-bottom:14px;">
            <button class="filter-btn active" onclick="setEquipmentFilter('all',this)">הכל</button>
            <button class="filter-btn" onclick="setEquipmentFilter('assigned',this)">מוחזק</button>
            <button class="filter-btn" onclick="setEquipmentFilter('available',this)">פנוי</button>
            <button class="filter-btn" onclick="setEquipmentFilter('faulty',this)">תקול</button>
        </div>

        <!-- Equipment Table -->
        <div class="sub-section">
            <div class="section-title">
                <div class="icon" style="background:#FBE9E7;color:#FF5722;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="1"/></svg></div>
                רשימת ציוד (<span id="equipmentCount">0</span> פריטים)
            </div>
            <div id="equipmentTableContainer"></div>
        </div>

        <!-- Signature History -->
        <div class="sub-section">
            <div class="section-title">
                <div class="icon" style="background:#E8EAF6;color:#3F51B5;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg></div>
                היסטוריית חתימות (<span id="signatureHistoryCount">0</span>)
            </div>
            <div id="signatureHistoryContainer"></div>
        </div>
    </div>
</div>

<!-- ====== MODALS ====== -->

<!-- Add/Edit Soldier Modal -->
<div class="modal-overlay" id="addSoldierModal">
    <div class="modal">
        <div class="modal-header">
            <h3 id="soldierModalTitle">הוספת חייל</h3>
            <button class="modal-close" onclick="closeModal('addSoldierModal')">&times;</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="soldierEditId" value="">
            <div class="form-group">
                <label>שם מלא</label>
                <input type="text" id="soldierName" placeholder="שם פרטי ושם משפחה">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>מספר אישי</label>
                    <input type="text" id="soldierId" placeholder="מספר אישי">
                </div>
                <div class="form-group">
                    <label>דרגה</label>
                    <select id="soldierRank">
                        <option value="טוראי">טוראי</option>
                        <option value="רב&quot;ט">רב"ט</option>
                        <option value="סמל">סמל</option>
                        <option value="סמ&quot;ר">סמ"ר</option>
                        <option value="רס&quot;ל">רס"ל</option>
                        <option value="רס&quot;ר">רס"ר</option>
                        <option value="סגן">סגן</option>
                        <option value="סרן">סרן</option>
                        <option value="רס&quot;ן">רס"ן</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>פלוגה</label>
                    <select id="soldierCompany">
                        <option value="a">פלוגה א (מבוא חורון)</option>
                        <option value="b">פלוגה ב (443)</option>
                        <option value="c">פלוגה ג (חשמונאים)</option>
                        <option value="d">פלוגה ד (עתודה)</option>
                        <option value="hq">חפ"ק מג"ד/סמג"ד</option>
                        <option value="palsam">פלס"ם</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>תפקיד</label>
                    <select id="soldierRole">
                        <option value="לוחם">לוחם</option>
                        <option value="מפקד">מפקד</option>
                        <option value="קצין">קצין</option>
                        <option value="נהג">נהג</option>
                        <option value="קשר">קשר</option>
                        <option value="מ&quot;פ">מ"פ</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>טלפון</label>
                <input type="text" id="soldierPhone" placeholder="050-0000000">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" onclick="saveSoldier()">שמור</button>
            <button class="btn" style="background:var(--bg)" onclick="closeModal('addSoldierModal')">ביטול</button>
        </div>
    </div>
</div>

<!-- Add/Edit Shift Modal -->
<div class="modal-overlay" id="addShiftModal">
    <div class="modal">
        <div class="modal-header">
            <h3 id="shiftModalTitle">שיבוץ למשמרת</h3>
            <button class="modal-close" onclick="closeModal('addShiftModal')">&times;</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="shiftEditId" value="">
            <div class="form-group">
                <label>פלוגה</label>
                <select id="shiftCompany" onchange="updateShiftOptions()">
                    <option value="a">פלוגה א (מבוא חורון)</option>
                    <option value="b">פלוגה ב (443)</option>
                    <option value="c">פלוגה ג (חשמונאים)</option>
                    <option value="d">פלוגה ד (עתודה)</option>
                    <option value="hq">חפ"ק מג"ד/סמג"ד</option>
                    <option value="palsam">פלס"ם</option>
                </select>
            </div>
            <div class="form-group">
                <label>משימה / פעילות</label>
                <select id="shiftTask"></select>
            </div>
            <div class="form-group">
                <label>תאריך</label>
                <input type="date" id="shiftDate" onchange="updateShiftOptions()">
            </div>
            <div class="form-group">
                <label>תבנית משמרת</label>
                <div class="shift-presets">
                    <button type="button" class="shift-preset-btn" onclick="applyShiftPreset('morning', this)">בוקר</button>
                    <button type="button" class="shift-preset-btn" onclick="applyShiftPreset('afternoon', this)">צהריים</button>
                    <button type="button" class="shift-preset-btn" onclick="applyShiftPreset('night', this)">לילה</button>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>שם המשמרת</label>
                    <input type="text" id="shiftName" placeholder='בוקר / צהריים / לילה'>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>שעת התחלה</label>
                    <input type="time" id="shiftStart" value="08:00" onchange="updateShiftOptions()">
                </div>
                <div class="form-group">
                    <label>שעת סיום</label>
                    <input type="time" id="shiftEnd" value="16:00" onchange="updateShiftOptions()">
                </div>
            </div>
            <div class="form-group">
                <label>חיילים משובצים (Ctrl+לחיצה לבחירה מרובה)</label>
                <select id="shiftSoldiers" multiple style="height:140px;width:100%"></select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" onclick="saveShift()">שמור משמרת</button>
            <button class="btn" style="background:var(--bg)" onclick="closeModal('addShiftModal')">ביטול</button>
        </div>
    </div>
</div>

<!-- Add/Edit Leave Modal -->
<div class="modal-overlay" id="addLeaveModal">
    <div class="modal">
        <div class="modal-header">
            <h3 id="leaveModalTitle">יציאה הביתה</h3>
            <button class="modal-close" onclick="closeModal('addLeaveModal')">&times;</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="leaveEditId" value="">
            <div class="form-group">
                <label>פלוגה</label>
                <select id="leaveCompany" onchange="updateLeaveSoldiers()">
                    <option value="a">פלוגה א</option>
                    <option value="b">פלוגה ב</option>
                    <option value="c">פלוגה ג</option>
                    <option value="d">פלוגה ד</option>
                    <option value="hq">חפ"ק מג"ד</option>
                    <option value="palsam">פלס"ם</option>
                </select>
            </div>
            <div class="form-group" id="leaveSoldierGroup">
                <label>חייל (ניתן לבחור מספר חיילים)</label>
                <select id="leaveSoldier" multiple style="height:100px"></select>
            </div>
            <div class="form-group" id="leaveSoldierDisplay" style="display:none;">
                <label>חייל</label>
                <div id="leaveSoldierName" style="padding:8px 12px;background:var(--bg);border-radius:8px;font-weight:600;"></div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>תאריך יציאה</label>
                    <input type="date" id="leaveStart">
                </div>
                <div class="form-group">
                    <label>שעת יציאה</label>
                    <input type="time" id="leaveStartTime" value="17:00">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>תאריך חזרה</label>
                    <input type="date" id="leaveEnd">
                </div>
                <div class="form-group">
                    <label>שעת חזרה</label>
                    <input type="time" id="leaveEndTime" value="08:00">
                </div>
            </div>
            <div class="form-group">
                <label>הערות</label>
                <input type="text" id="leaveNotes" placeholder="סיבה / הערות">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-warning" onclick="saveLeave()">שמור יציאה</button>
            <button class="btn" style="background:var(--bg)" onclick="closeModal('addLeaveModal')">ביטול</button>
        </div>
    </div>
</div>

<!-- Add Rotation Group Modal -->
<div class="modal-overlay" id="addRotationGroupModal">
    <div class="modal">
        <div class="modal-header" style="background:#5C6BC0;">
            <h3>קבוצת רוטציה חדשה</h3>
            <button class="modal-close" onclick="closeModal('addRotationGroupModal')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>שם הקבוצה</label>
                <input type="text" id="rotGroupName" placeholder='לדוגמה: קבוצה א, מחזור 1'>
            </div>
            <div class="form-group">
                <label>פלוגה</label>
                <select id="rotGroupCompany" onchange="updateRotGroupSoldiers()">
                    <option value="a">פלוגה א</option>
                    <option value="b">פלוגה ב</option>
                    <option value="c">פלוגה ג</option>
                    <option value="d">פלוגה ד</option>
                    <option value="hq">חפ"ק מג"ד</option>
                    <option value="palsam">פלס"ם</option>
                    <option value="all">כל הפלוגות</option>
                </select>
            </div>
            <div class="form-group">
                <label>תאריך תחילת מחזור (יום הגעה לבסיס)</label>
                <input type="date" id="rotGroupStartDate">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>ימים בבסיס</label>
                    <input type="number" id="rotGroupDaysIn" value="10" min="1">
                </div>
                <div class="form-group">
                    <label>ימים בבית</label>
                    <input type="number" id="rotGroupDaysOut" value="4" min="1">
                </div>
            </div>
            <div class="form-group">
                <label>חיילים בקבוצה (Ctrl+לחיצה)</label>
                <select id="rotGroupSoldiers" multiple style="height:160px;width:100%"></select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" onclick="saveRotationGroup()">שמור קבוצה</button>
            <button class="btn" style="background:var(--bg)" onclick="closeModal('addRotationGroupModal')">ביטול</button>
        </div>
    </div>
</div>

<!-- ====== TAB: SETTINGS ====== -->
<div class="tab-content" id="tab-settings">
    <div class="main-content">
        <div class="info-box">
            <span class="info-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg></span>
            <div><strong>הגדרות מערכת</strong> - שינויים נשמרים אוטומטית. רק מנהל המערכת יכול לגשת לדף זה.</div>
        </div>
        <div class="settings-grid" id="settingsContent"></div>
    </div>
</div>

<!-- Add Equipment Modal -->
<div class="modal-overlay" id="addEquipmentModal">
    <div class="modal">
        <div class="modal-header" style="background:#FF5722;">
            <h3 id="equipmentModalTitle">הוספת פריט ציוד</h3>
            <button class="modal-close" onclick="closeModal('addEquipmentModal')">&times;</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="equipEditId" value="">
            <div class="form-group">
                <label>סוג ציוד</label>
                <select id="equipType">
                    <option value="נשק">נשק</option>
                    <option value="משקפת">משקפת</option>
                    <option value="אמר&quot;ל">אמר"ל</option>
                    <option value="מצפן">מצפן</option>
                    <option value="מכ&quot;מ">מכ"מ</option>
                    <option value="קשר">מכשיר קשר</option>
                    <option value="מגן בליסטי">מגן בליסטי</option>
                    <option value="קסדה">קסדה</option>
                    <option value="אפוד">אפוד קרבי</option>
                    <option value="אחר">אחר</option>
                </select>
            </div>
            <div class="form-group" id="equipCustomTypeGroup" style="display:none;">
                <label>שם הציוד</label>
                <input type="text" id="equipCustomType" placeholder="הזן שם ציוד">
            </div>
            <div class="form-group">
                <label>מספר סידורי</label>
                <input type="text" id="equipSerial" placeholder="מספר סידורי / קטלוגי">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>פלוגה</label>
                    <select id="equipCompany">
                        <option value="a">פלוגה א</option>
                        <option value="b">פלוגה ב</option>
                        <option value="c">פלוגה ג</option>
                        <option value="d">פלוגה ד</option>
                        <option value="hq">חפ"ק מג"ד</option>
                        <option value="palsam">פלס"ם</option>
                        <option value="gdudi">גדודי</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>מצב</label>
                    <select id="equipCondition">
                        <option value="תקין">תקין</option>
                        <option value="תקול">תקול</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>הערות</label>
                <input type="text" id="equipNotes" placeholder="הערות נוספות">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" onclick="saveEquipment()">שמור פריט</button>
            <button class="btn" style="background:var(--bg)" onclick="closeModal('addEquipmentModal')">ביטול</button>
        </div>
    </div>
</div>

<!-- Sign Equipment Modal -->
<div class="modal-overlay" id="signEquipmentModal">
    <div class="modal" style="max-width:700px;">
        <div class="modal-header" style="background:#4CAF50;">
            <h3 id="signModalTitle">חתימה על ציוד</h3>
            <button class="modal-close" onclick="closeModal('signEquipmentModal')">&times;</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="signEquipId" value="">
            <div class="form-group" id="signEquipSelectGroup">
                <label>בחר פריט ציוד</label>
                <select id="signEquipSelect" onchange="onSignEquipSelect()">
                    <option value="">-- בחר פריט --</option>
                </select>
            </div>
            <div id="signEquipInfo" style="display:none;background:var(--bg);border-radius:10px;padding:12px;margin-bottom:14px;">
            </div>
            <div class="form-group">
                <label>סנן לפי פלוגה</label>
                <select id="signCompany" onchange="updateSignSoldiers()">
                    <option value="all">כל הפלוגות</option>
                    <option value="a">פלוגה א (מבוא חורון)</option>
                    <option value="b">פלוגה ב (443)</option>
                    <option value="c">פלוגה ג (חשמונאים)</option>
                    <option value="d">פלוגה ד (עתודה)</option>
                    <option value="hq">חפ"ק מג"ד</option>
                    <option value="palsam">פלס"ם</option>
                </select>
            </div>
            <div class="form-group">
                <label>חייל</label>
                <select id="signSoldier" onchange="onSignSoldierSelect()">
                    <option value="">-- בחר חייל --</option>
                </select>
            </div>
            <div id="signSoldierInfo" style="display:none;background:var(--bg);border-radius:10px;padding:12px;margin-bottom:14px;">
            </div>
            <div class="form-group">
                <label>חתימה דיגיטלית (חתום עם האצבע או העכבר)</label>
                <div class="signature-container">
                    <canvas id="signatureCanvas" width="600" height="200"></canvas>
                    <button class="btn btn-sm" style="background:var(--bg);margin-top:6px;" onclick="clearSignatureCanvas()">&#128465; נקה חתימה</button>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-success" onclick="confirmSignEquipment()">&#9998; אשר חתימה ושמור PDF</button>
            <button class="btn" style="background:var(--bg)" onclick="closeModal('signEquipmentModal')">ביטול</button>
        </div>
    </div>
</div>

<!-- Return Equipment Modal -->
<div class="modal-overlay" id="returnEquipmentModal">
    <div class="modal" style="max-width:700px;">
        <div class="modal-header" style="background:#FF9800;">
            <h3>זיכוי / החזרת ציוד</h3>
            <button class="modal-close" onclick="closeModal('returnEquipmentModal')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>בחר פריט מוחזק להחזרה</label>
                <select id="returnEquipSelect" onchange="onReturnEquipSelect()">
                    <option value="">-- בחר פריט --</option>
                </select>
            </div>
            <div id="returnEquipInfo" style="display:none;background:var(--bg);border-radius:10px;padding:12px;margin-bottom:14px;">
            </div>
            <div class="form-group">
                <label>חתימת מחזיר (חתום עם האצבע או העכבר)</label>
                <div class="signature-container">
                    <canvas id="returnSignatureCanvas" width="600" height="200"></canvas>
                    <button class="btn btn-sm" style="background:var(--bg);margin-top:6px;" onclick="clearReturnSignatureCanvas()">&#128465; נקה חתימה</button>
                </div>
            </div>
            <div class="form-group">
                <label>הערות</label>
                <input type="text" id="returnNotes" placeholder="מצב הציוד בהחזרה">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-warning" onclick="confirmReturnEquipment()">&#8634; אשר זיכוי ושמור PDF</button>
            <button class="btn" style="background:var(--bg)" onclick="closeModal('returnEquipmentModal')">ביטול</button>
        </div>
    </div>
</div>

<!-- Footer Credit -->
<div class="app-footer" style="text-align:center;padding:20px;background:var(--primary-dark);color:rgba(255,255,255,0.6);font-size:0.8em;margin-top:30px;margin-right:260px;transition:margin-right 0.3s cubic-bezier(0.4,0,0.2,1);">
    <a href="https://wa.me/972542012000" target="_blank" style="color:rgba(255,255,255,0.8);text-decoration:none;display:inline-flex;align-items:center;gap:8px;">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
        נבנה ע"י אלחי פיין | 054-2012000
    </a>
</div>
</div><!-- end mainApp -->

<script src="app.js"></script>
</body>
</html>
